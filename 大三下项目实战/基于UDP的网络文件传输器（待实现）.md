## 一、初期构想

基本的方针是从简单到复杂，

先搞清楚基本的在公网上两台电脑怎么做文件传输，

等等，似乎这不就成了P2P？

这也不是我想做的。

所以搞清楚，怎么和自己的服务器产生联动，

实现简单的文件传输和分发。

就是一方可以先将文件传上去，服务器要返回一个链接，拿到链接的人就可以下载这个文件。

> 还要有些安全性手段，怎么防止这个链接被窃取？
>
> 或者说要防止的问题不是这个，而是怎么保证怎么把这个文件安全地，不泄密的传给对方。
>
> 除了要在传输过程中加密，而且也要在对方处采取一些手段。

但以上似乎不是重点，

我们现在需要先实现如何传输，

而且要做到底层代码自己写。

所以问题就是，如何使用java实现一个基于UDP的网络文件传输器？

架构是B/S，传输应该是后端程序的一个模块，通过对外提供接口来使用。

但似乎也有问题，就是这不就是用了服务器来做中转？

能不能服务器只做中介，来把两个有互传需求的主机连接起来，利用他们之间的网络，而不经过服务器传输数据，或者，服务器要保存什么的话，也只是保存这个需求。等到双方状态都好了，在传输？

等等这不还是p2p？

算了，还是不搞p2p了。

## 二、重点考虑

需要考虑的点：

基础的传输代码

协议设计

状态维护：无状态

难点：

协议不稳定，数据会丢失

文件分块（hash校验）

+多线程传输

重传协议（解决包丢失）

断点传输（双文件，一个是原文件，一个是传输记录文件，弱哈希，rsync做校验（rolling hash + MD5））

位图检查文件状态

## 三、开始实现

我觉得，还是得先把框架搭起来，

主要是因为基础的程序已经有了，

但是我还想做日志，这就得有个框架就可以便宜行事了。

而且，感觉细想的话，

上传上来后，文件存在什么地方？如何规划？总得压缩来节省空间吧？

步骤分为：

上传、存储、下载

### （一）上传

简单的UDP传输程序已经有了，

现在就是需要完善了，

可以从这么几方面入手，

如何保证文件正确无误的传输上去？

UDP传输难免会有遗漏

